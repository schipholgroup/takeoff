stages:
- test
- build
- deploy

services:
- docker:dind

lint:
  image: python:3.7
  stage: test
  script:
  - python setup.py flake8

test:
  image: python:3.7
  stage: test
  script:
  - python setup.py test

build-image:
  image: docker:stable
  stage: build
  script:
  - export DOCKER_HOST="tcp://localhost:2375"
  - docker login --username $jfrog_username --password $jfrog_password schipholsdh-docker.jfrog.io
  - docker build -t runway:latest -f Dockerfile_python .

push-image:
  image: runway:latest
  stage: deploy
  script:
  - runway
